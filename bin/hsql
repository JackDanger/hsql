#!/usr/bin/env ruby

filename, env = ARGV

unless filename && env
  puts "USAGE: #{__FILE__} file environment"
  puts ''
  puts 'file:        any *.sql file that has a YAML header ending in three hyphens.'
  puts 'environment: Must be one of the keys of the "data" hash in the YAML header of the .sql file.'
  puts ''
  puts 'for details, run:'
  puts '  open https://github.com/JackDanger/hsql'
  exit 1
end


require_relative "../lib/hsql"

begin
  file = File.new(filename)
rescue Errno::ENOENT
  puts "#{filename.inspect}: No such file"
end

HSQL.parse_file(file, env).queries.each do |query|
  # Runs the query through the parser and then deparses it
  puts query
end
